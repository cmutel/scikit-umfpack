os: Visual Studio 2015

environment:
  global:
    # SDK v7.0 MSVC Express 2008's SetEnv.cmd script will fail if the
    # /E:ON and /V:ON options are not enabled in the batch script intepreter
    # See: http://stackoverflow.com/a/13751649/163740
    CMD_IN_ENV: "cmd /E:ON /V:ON /C .\\appveyor\\run_with_env.cmd"

  matrix:
      - PYTHON: "C:\\Miniconda35-x64"
        PYTHON_VERSION: "3.5"
        PYTHON_ARCH: "64"
        CONDA_PY: "35"

# clone directory
clone_folder: c:\projects\scikit-umfpack

platform: x64

install:
  - if not exist "c:\projects" mkdir c:\projects
  - if not exist "c:\projects\suitesparse-install" mkdir c:\projects\suitesparse-install

  - ECHO "Filesystem root:"
  - ps: "ls \"C:/\""

  - ECHO "Installed SDKs:"
  - ps: "ls \"C:/Program Files/Microsoft SDKs/Windows\""

  # This upates conda and installs the necessary packages.
  - cd c:\projects\scikit-umfpack\
  - powershell .\\appveyor\\install.ps1
  - SET PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%
  - python --version
  - python -c "import struct; print(struct.calcsize('P') * 8)"

  - powershell -Command "Invoke-WebRequest https://github.com/jlblancoc/suitesparse-metis-for-windows/archive/master.tar.gz -OutFile c:\projects\ss-source.zip"
  - cd c:\projects
  - tar xzf ss-source.zip
  - rename suitesparse-metis-for-windows-master suitesparse-src
  - cd suitesparse-src

  - type c:\projects\scikit-umfpack\appveyor\add-debugg-cmake.txt >> CMakeLists.txt
  - cmake -G "Visual Studio 14 2015 Win64" -DSUITESPARSE_INSTALL_PREFIX:PATH=c:\projects\suitesparse-install
  - dir
  - Msbuild.exe /clp:Summary SuiteSparseProject.sln
  - dir c:\projects\suitesparse-install\
  - dir c:\projects\suitesparse-src\
  - SET PATH=%PATH%;c:\projects\suitesparse-src\lib*\lapack_blas_windows\;c:\projects\suitesparse-src\lib*
  - SET UMFPACK=c:\projects\suitesparse-src

build: false

test_script:
  - echo Skipped Tests

after_test:
  - cd c:\projects\scikit-umfpack
  - python setup.py bdist_wheel

artifacts:
  # bdist_wheel puts your built wheel in the dist directory
  - path: dist\*
